<div class="app-shell">
  <mat-sidenav-container class="shell-container">
    <mat-sidenav
      #drawer
      class="side-nav"
      [mode]="(isHandset$ | async) ? 'over' : 'side'"
      [opened]="!(isHandset$ | async)"
    >
      <div class="brand">
        <div class="brand-logo">
          <img src="assets/images/backless_logo.png" alt="SelfAccounting.AI Logo" class="logo-image" />
        </div>
        <div class="brand-label">
          <span class="brand-title">SelfAccounting.AI</span>
          <small class="brand-subtitle">Powered by <a href="https://stryvon.ai" target="_blank" rel="noopener noreferrer">Stryvon.AI</a></small>
        </div>
      </div>
      <mat-nav-list #sideNavList>
        <ng-container *ngFor="let item of navItems">
          <ng-container *ngIf="item.children?.length; else singleLink">
            <div class="nav-group">
              <div 
                class="nav-group-header" 
                (click)="toggleNavGroup(item.label)"
                [class.expanded]="isNavGroupExpanded(item.label)"
              >
                <mat-icon class="nav-group-icon">{{ item.icon || 'folder' }}</mat-icon>
                <span>{{ item.label }}</span>
                <span class="badge" *ngIf="item.badgeCount$ | async as count">
                  {{ count }}
                </span>
                <mat-icon class="nav-group-chevron">
                  {{ isNavGroupExpanded(item.label) ? 'expand_less' : 'expand_more' }}
                </mat-icon>
              </div>
              <div 
                class="nav-group-children"
                [class.expanded]="isNavGroupExpanded(item.label)"
              >
                <ng-container *ngFor="let child of item.children">
                  <a
                    *ngIf="!isNavItemDisabled(child); else disabledChildLink"
                    mat-list-item
                    class="nav-child"
                    [routerLink]="child.route"
                    [queryParams]="child.queryParams"
                    routerLinkActive="active-child"
                    [routerLinkActiveOptions]="{ exact: true }"
                    (click)="closeDrawerIfHandset(drawer)"
                  >
                    <span>{{ child.label }}</span>
                    <span class="badge" *ngIf="child.badgeCount$ | async as count">
                      {{ count }}
                    </span>
                  </a>
                  <ng-template #disabledChildLink>
                    <div
                      mat-list-item
                      class="nav-child nav-disabled"
                      [matTooltip]="child.disabledReason || 'Locked'"
                    >
                      <span>{{ child.label }}</span>
                      <span class="badge" *ngIf="child.badgeCount$ | async as count">
                        {{ count }}
                      </span>
                      <mat-icon class="lock-icon">lock</mat-icon>
                    </div>
                  </ng-template>
                </ng-container>
              </div>
            </div>
          </ng-container>
          <ng-template #singleLink>
            <ng-container *ngIf="item.route">
              <a
                *ngIf="!isNavItemDisabled(item); else disabledSingleLink"
                mat-list-item
                class="nav-link"
                [routerLink]="item.route"
                [queryParams]="item.queryParams"
                routerLinkActive="active"
                [routerLinkActiveOptions]="{ exact: true }"
                (click)="closeDrawerIfHandset(drawer)"
              >
                <mat-icon matListIcon>{{ item.icon || 'chevron_right' }}</mat-icon>
                <span matLine>{{ item.label }}</span>
                <span class="badge" *ngIf="item.badgeCount$ | async as count">
                  {{ count }}
                </span>
              </a>
              <ng-template #disabledSingleLink>
                <div
                  mat-list-item
                  class="nav-link nav-disabled"
                  [matTooltip]="item.disabledReason || 'Locked'"
                >
                  <mat-icon matListIcon>{{ item.icon || 'chevron_right' }}</mat-icon>
                  <span matLine>{{ item.label }}</span>
                  <span class="badge" *ngIf="item.badgeCount$ | async as count">
                    {{ count }}
                  </span>
                  <mat-icon class="lock-icon">lock</mat-icon>
                </div>
              </ng-template>
            </ng-container>
          </ng-template>
        </ng-container>
      </mat-nav-list>
      <div class="side-footer">
        <div class="contact-info">
          <mat-icon>phone</mat-icon>
          <span class="contact-number">+971-58-900-3150</span>
        </div>
        <div class="contact-info">
          <mat-icon>mail</mat-icon>
          <a class="contact-number" href="mailto:support@selfaccounting.ai">support&#64;selfaccounting.ai</a>
        </div>
        <div class="social-links">
          <a
            href="https://www.instagram.com/selfaccounting.ai?igsh=MWo0NDg5bDVodGYwdg=="
            target="_blank"
            rel="noopener noreferrer"
            class="social-link"
            matTooltip="Follow us on Instagram"
            aria-label="Instagram"
          >
            <svg class="social-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" fill="currentColor" aria-hidden="true">
              <path d="M224.1 141c-63.6 0-114.9 51.3-114.9 114.9s51.3 114.9 114.9 114.9S339 319.5 339 255.9 287.7 141 224.1 141zm0 189.6c-41.1 0-74.7-33.5-74.7-74.7s33.5-74.7 74.7-74.7 74.7 33.5 74.7 74.7-33.6 74.7-74.7 74.7zm146.4-194.3c0 14.9-12 26.8-26.8 26.8-14.9 0-26.8-12-26.8-26.8s12-26.8 26.8-26.8 26.8 12 26.8 26.8zm76.1 27.2c-1.7-35.9-9.9-67.7-36.2-93.9-26.2-26.2-58-34.5-93.9-36.2-37-2.1-147.9-2.1-184.9 0-35.8 1.7-67.6 9.9-93.9 36.1s-34.5 58-36.2 93.9c-2.1 37-2.1 147.9 0 184.9 1.7 35.9 9.9 67.7 36.2 93.9s58 34.5 93.9 36.2c37 2.1 147.9 2.1 184.9 0 35.9-1.7 67.7-9.9 93.9-36.2 26.2-26.2 34.5-58 36.2-93.9 2.1-37 2.1-147.8 0-184.8zM398.8 388c-7.8 19.6-22.9 34.7-42.6 42.6-29.5 11.7-99.5 9-132.1 9s-102.7 2.6-132.1-9c-19.6-7.8-34.7-22.9-42.6-42.6-11.7-29.5-9-99.5-9-132.1s-2.6-102.7 9-132.1c7.8-19.6 22.9-34.7 42.6-42.6 29.5-11.7 99.5-9 132.1-9s102.7-2.6 132.1 9c19.6 7.8 34.7 22.9 42.6 42.6 11.7 29.5 9 99.5 9 132.1s2.7 102.7-9 132.1z"/>
            </svg>
          </a>
          <a
            href="https://www.linkedin.com/company/111421971"
            target="_blank"
            rel="noopener noreferrer"
            class="social-link"
            matTooltip="Connect with us on LinkedIn"
            aria-label="LinkedIn"
          >
            <svg class="social-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" fill="currentColor" aria-hidden="true">
              <path d="M100.28 448H7.4V148.9h92.88zM53.79 108.1C24.09 108.1 0 83.5 0 53.8a53.79 53.79 0 0 1 107.58 0c0 29.7-24.1 54.3-53.79 54.3zM447.9 448h-92.68V302.4c0-34.7-.7-79.2-48.29-79.2-48.29 0-55.69 37.7-55.69 76.7V448h-92.78V148.9h89.08v40.8h1.3c12.4-23.5 42.69-48.3 87.88-48.3 94 0 111.28 61.9 111.28 142.3V448z"/>
            </svg>
          </a>
          <a
            href="https://www.youtube.com/@selfaccountingai"
            target="_blank"
            rel="noopener noreferrer"
            class="social-link"
            matTooltip="Watch us on YouTube"
            aria-label="YouTube"
          >
            <svg class="social-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" fill="currentColor" aria-hidden="true">
              <path d="M549.7 124.1c-6.3-23.7-24.8-42.3-48.3-48.6C458.8 64 288 64 288 64S117.2 64 74.6 75.5c-23.5 6.3-42 24.9-48.3 48.6C14.7 167 14.7 256 14.7 256s0 89 11.6 131.9c6.3 23.7 24.8 42.3 48.3 48.6C117.2 448 288 448 288 448s170.8 0 213.4-11.5c23.5-6.3 42-24.9 48.3-48.6C561.3 345 561.3 256 561.3 256s0-89-11.6-131.9zM232 336V176l144 80-144 80z"/>
            </svg>
          </a>
        </div>
        <button mat-stroked-button color="primary" (click)="logout()">
          <mat-icon>logout</mat-icon>
          Sign out
        </button>
      </div>
    </mat-sidenav>

    <mat-sidenav-content class="content-area">
      <mat-toolbar color="primary" class="top-bar">
        <button
          mat-icon-button
          class="menu-button"
          (click)="drawer.toggle()"
          *ngIf="isHandset$ | async"
        >
          <mat-icon>menu</mat-icon>
        </button>
        <span class="page-title">
          <ng-container *ngIf="user$ | async as user">
            {{ user.organization?.name || 'SelfAccounting.AI' }}
          </ng-container>
        </span>

        <span class="spacer"></span>
        <button mat-icon-button aria-label="Notifications">
          <mat-icon>notifications</mat-icon>
        </button>
        <button mat-icon-button aria-label="Help">
          <mat-icon>help_outline</mat-icon>
        </button>
        <ng-container *ngIf="user$ | async as user">
          <div class="user-chip">
            <div class="user-avatar">
              {{ user.name | slice: 0:2 | uppercase }}
            </div>
            <div class="user-meta">
              <span class="user-name">{{ user.name }}</span>
              <small class="user-role">{{ user.role | titlecase }}</small>
            </div>
          </div>
        </ng-container>
      </mat-toolbar>

      <div class="content-wrapper">
        <main class="content">
          <router-outlet></router-outlet>
        </main>
      </div>
    </mat-sidenav-content>
  </mat-sidenav-container>
</div>

