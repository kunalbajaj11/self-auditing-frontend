<section class="bank-accounts">
  <header class="header">
    <div class="header-content">
      <h1>Bank Accounts</h1>
      <p>View all bank transactions including expenses paid via bank transfer. Add new bank transactions manually using the "Add Bank Transaction" button.</p>
    </div>
    <div class="header-actions">
      <button mat-icon-button matTooltip="Refresh" (click)="reload()">
        <mat-icon>refresh</mat-icon>
      </button>
      <button mat-raised-button color="primary" (click)="openAddTransactionDialog()">
        <mat-icon>add</mat-icon>
        <span class="button-label">Add Bank Transaction</span>
      </button>
    </div>
  </header>

  <!-- Date Range Filter -->
  <section class="filters-section" *ngIf="dateRangeForm">
    <mat-card class="filters-card">
      <mat-card-content>
        <form [formGroup]="dateRangeForm" class="date-range-form">
          <mat-form-field appearance="outline">
            <mat-label>Start Date</mat-label>
            <input matInput [matDatepicker]="startDatePicker" formControlName="startDate" />
            <mat-datepicker-toggle matIconSuffix [for]="startDatePicker"></mat-datepicker-toggle>
            <mat-datepicker #startDatePicker></mat-datepicker>
          </mat-form-field>
          <mat-form-field appearance="outline">
            <mat-label>End Date</mat-label>
            <input matInput [matDatepicker]="endDatePicker" formControlName="endDate" />
            <mat-datepicker-toggle matIconSuffix [for]="endDatePicker"></mat-datepicker-toggle>
            <mat-datepicker #endDatePicker></mat-datepicker>
          </mat-form-field>
        </form>
      </mat-card-content>
    </mat-card>
  </section>

  <!-- Balance Summary -->
  <section class="balance-summary" *ngIf="dateRangeForm">
    <div class="balance-cards">
      <mat-card class="balance-card">
        <mat-card-header>
          <mat-card-title>Opening Balance</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="balance-amount" [class.negative]="openingBalance < 0">
            {{ openingBalance >= 0 ? '+' : '' }}{{ openingBalance | number: '1.2-2' }} AED
          </div>
        </mat-card-content>
      </mat-card>
      <mat-card class="balance-card">
        <mat-card-header>
          <mat-card-title>Period Total</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="balance-amount" [class.negative]="periodTotal < 0">
            {{ periodTotal >= 0 ? '+' : '' }}{{ periodTotal | number: '1.2-2' }} AED
          </div>
        </mat-card-content>
      </mat-card>
      <mat-card class="balance-card closing">
        <mat-card-header>
          <mat-card-title>Closing Balance</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="balance-amount" [class.negative]="closingBalance < 0">
            {{ closingBalance >= 0 ? '+' : '' }}{{ closingBalance | number: '1.2-2' }} AED
          </div>
        </mat-card-content>
      </mat-card>
    </div>
  </section>

  <section class="transactions-section">
    <mat-card class="transactions-card">
      <mat-card-header>
        <div class="card-title-with-icon">
          <mat-icon>account_balance</mat-icon>
          <mat-card-title>Bank Transactions</mat-card-title>
        </div>
      </mat-card-header>
      <mat-card-content>
        <div class="table-container">
          <table mat-table [dataSource]="dataSource" class="transactions-table">
            <ng-container matColumnDef="date">
              <th mat-header-cell *matHeaderCellDef>Date</th>
              <td mat-cell *matCellDef="let transaction">
                {{ transaction.date | date: 'mediumDate' }}
              </td>
            </ng-container>

            <ng-container matColumnDef="type">
              <th mat-header-cell *matHeaderCellDef>Type</th>
              <td mat-cell *matCellDef="let transaction">
                <mat-chip [color]="getTypeColor(transaction.type)" selected>
                  {{ getTypeLabel(transaction.type) }}
                </mat-chip>
              </td>
            </ng-container>

            <ng-container matColumnDef="vendorOrCustomer">
              <th mat-header-cell *matHeaderCellDef>Vendor / Customer</th>
              <td mat-cell *matCellDef="let transaction">
                <div class="primary">{{ transaction.vendorOrCustomer }}</div>
              </td>
            </ng-container>

            <ng-container matColumnDef="description">
              <th mat-header-cell *matHeaderCellDef>Description</th>
              <td mat-cell *matCellDef="let transaction">
                <div class="description">{{ transaction.description }}</div>
                <div class="reference" *ngIf="transaction.referenceNumber">
                  Ref: {{ transaction.referenceNumber }}
                </div>
              </td>
            </ng-container>

            <ng-container matColumnDef="amount">
              <th mat-header-cell *matHeaderCellDef class="text-right">Amount</th>
              <td mat-cell *matCellDef="let transaction" class="text-right">
                <strong>{{ transaction.currency }} {{ transaction.amount | number: '1.0-2' }}</strong>
              </td>
            </ng-container>

            <ng-container matColumnDef="paymentMethod">
              <th mat-header-cell *matHeaderCellDef>Payment Method</th>
              <td mat-cell *matCellDef="let transaction">
                <span class="payment-method">{{ getPaymentMethodLabel(transaction.paymentMethod) }}</span>
              </td>
            </ng-container>

            <ng-container matColumnDef="actions">
              <th mat-header-cell *matHeaderCellDef>Actions</th>
              <td mat-cell *matCellDef="let transaction">
                <button
                  mat-button
                  color="primary"
                  (click)="transaction.type === 'expense' ? viewExpense(transaction) : (transaction.type === 'sales' || transaction.type === 'payment') ? viewInvoice(transaction) : viewJournalEntry(transaction)"
                >
                  <mat-icon>visibility</mat-icon>
                  View
                </button>
              </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="columns" class="table-header"></tr>
            <tr mat-row *matRowDef="let row; columns: columns" class="table-row"></tr>
          </table>

          <div class="table-overlay" *ngIf="loading">
            <mat-progress-spinner mode="indeterminate"></mat-progress-spinner>
          </div>
        </div>

        <div class="empty" *ngIf="!loading && dataSource.data.length === 0">
          <mat-icon>account_balance</mat-icon>
          <p>No bank transactions found.</p>
          <p class="hint">Bank transactions include expenses paid via bank transfer, invoice payments with bank transfer payment method, and journal entries with "Bank Paid" or "Bank Received" status. Use "Add Bank Transaction" to record new bank transactions.</p>
        </div>
      </mat-card-content>
    </mat-card>
  </section>
</section>

