<section class="upload">
  <header class="header">
    <div>
      <h2>Submit Expense</h2>
      <p>Upload receipt details for approval. Finance will review and approve.</p>
    </div>
  </header>

  <mat-card>
    <form [formGroup]="form" class="form">
      <mat-form-field appearance="outline">
        <mat-label>Vendor</mat-label>
        <input matInput formControlName="vendorName" required />
        <mat-error *ngIf="form.get('vendorName')?.hasError('required')">
          Vendor name is required
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Category</mat-label>
        <mat-select formControlName="categoryId">
          <mat-option value="">Uncategorized</mat-option>
          <mat-option *ngFor="let category of categories" [value]="category.id">
            {{ category.name }}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Amount (AED)</mat-label>
        <input matInput type="number" formControlName="amount" required />
        <mat-error *ngIf="form.get('amount')?.hasError('required')">
          Amount is required
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>VAT (AED)</mat-label>
        <input matInput type="number" formControlName="vatAmount" />
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Expense Date</mat-label>
        <input matInput [matDatepicker]="expenseDatePicker" formControlName="expenseDate" placeholder="Select expense date" required />
        <mat-datepicker-toggle matIconSuffix [for]="expenseDatePicker"></mat-datepicker-toggle>
        <mat-datepicker #expenseDatePicker></mat-datepicker>
      </mat-form-field>

      <mat-form-field appearance="outline" class="full">
        <mat-label>Description</mat-label>
        <textarea matInput rows="3" formControlName="description"></textarea>
      </mat-form-field>

      <mat-form-field appearance="outline" class="full" *ngIf="isEnterprise$ | async">
        <mat-label>Receipt URL (optional)</mat-label>
        <input matInput formControlName="attachmentUrl" placeholder="https://..." />
        <mat-hint>Document upload is available for Enterprise license</mat-hint>
      </mat-form-field>
      <mat-card *ngIf="!(isEnterprise$ | async)" class="license-notice">
        <mat-card-content>
          <mat-icon color="warn">info</mat-icon>
          <div>
            <strong>Document Upload Feature</strong>
            <p>Document upload is available for Enterprise license holders only. Please contact your administrator to upgrade.</p>
          </div>
        </mat-card-content>
      </mat-card>
    </form>

    <mat-card-actions align="end">
      <button mat-flat-button color="primary" (click)="submit()" [disabled]="loading">
        <mat-progress-spinner
          *ngIf="loading"
          diameter="20"
          mode="indeterminate"
        ></mat-progress-spinner>
        <span *ngIf="!loading">Submit Expense</span>
      </button>
    </mat-card-actions>
  </mat-card>
</section>

