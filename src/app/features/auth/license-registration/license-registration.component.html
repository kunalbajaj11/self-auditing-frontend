<div class="auth-page">
  <mat-card class="auth-card">
    <mat-card-header>
      <div mat-card-avatar class="auth-avatar">
        <mat-icon>verified_user</mat-icon>
      </div>
      <mat-card-title>Activate Your SelfAccounting.AI Workspace</mat-card-title>
      <mat-card-subtitle>
        Use the license key provided by SelfAccounting.AI Super Admin to set up your company account.
      </mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>
      <form [formGroup]="form" class="auth-form" (ngSubmit)="submit()">
        <section class="form-section">
          <h3>License Key</h3>
          <div class="two-column">
            <mat-form-field appearance="outline">
              <mat-label>License Key</mat-label>
              <input
                matInput
                placeholder="XXXX-XXXX-XXXX-XXXX"
                formControlName="licenseKey"
                autocomplete="off"
              />
              <mat-error *ngIf="licenseKeyControl.hasError('required')">
                License key is required
              </mat-error>
            </mat-form-field>

            <button
              mat-stroked-button
              color="primary"
              type="button"
              class="validate-button"
              (click)="validateLicense()"
              [disabled]="validating"
            >
              <mat-progress-spinner
                *ngIf="validating"
                mode="indeterminate"
                diameter="18"
                strokeWidth="3"
              ></mat-progress-spinner>
              <span *ngIf="!validating">Validate Key</span>
            </button>
          </div>

          <div *ngIf="licenseInfo" class="license-overview">
            <mat-icon color="primary">check_circle</mat-icon>
            <div>
              <p>
                License valid until
                <strong>{{ licenseInfo.expiresAt | date: 'mediumDate' }}</strong>
              </p>
              <p class="muted" *ngIf="licenseInfo.planType">
                Plan: <strong>{{ licenseInfo.planType | titlecase }}</strong>
              </p>
              <p class="muted" *ngIf="!licenseInfo.planType">
                Select a plan that matches this license.
              </p>
            </div>
          </div>
        </section>

        <section class="form-section">
          <h3>Organization Details</h3>
          <div class="two-column">
            <mat-form-field appearance="outline">
              <mat-label>Organization Name</mat-label>
              <input matInput formControlName="organizationName" />
              <mat-error *ngIf="form.controls.organizationName.hasError('required')">
                Organization name is required
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Plan</mat-label>
              <mat-select formControlName="planType" [disabled]="form.controls.planType.disabled">
                <mat-option *ngFor="let plan of planTypes" [value]="plan">
                  {{ plan | titlecase }}
                </mat-option>
              </mat-select>
              <mat-error *ngIf="form.controls.planType.hasError('required')">
                Plan selection is required
              </mat-error>
            </mat-form-field>
          </div>

          <div class="two-column">
            <mat-form-field appearance="outline">
              <mat-label>VAT Number</mat-label>
              <input matInput formControlName="vatNumber" />
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Currency</mat-label>
              <input matInput formControlName="currency" />
            </mat-form-field>
          </div>

          <mat-form-field appearance="outline">
            <mat-label>Registered Address</mat-label>
            <textarea matInput rows="2" formControlName="address"></textarea>
          </mat-form-field>

          <div class="two-column">
            <mat-form-field appearance="outline">
              <mat-label>Fiscal Year Start</mat-label>
              <input matInput [matDatepicker]="fiscalYearStartPicker" formControlName="fiscalYearStart" placeholder="Select fiscal year start" />
              <mat-datepicker-toggle matIconSuffix [for]="fiscalYearStartPicker"></mat-datepicker-toggle>
              <mat-datepicker #fiscalYearStartPicker></mat-datepicker>
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Storage Quota (MB)</mat-label>
              <input matInput type="number" formControlName="storageQuotaMb" />
            </mat-form-field>
          </div>

          <div class="two-column">
            <mat-form-field appearance="outline">
              <mat-label>Primary Contact Person</mat-label>
              <input matInput formControlName="contactPerson" />
            </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>Contact Email</mat-label>
                <input matInput type="email" formControlName="contactEmail" />
                <mat-error *ngIf="form.controls.contactEmail.hasError('email')">
                  Enter a valid email address
                </mat-error>
              </mat-form-field>
          </div>
        </section>

        <section class="form-section">
          <h3>Administrator Account</h3>
          <div class="two-column">
            <mat-form-field appearance="outline">
              <mat-label>Admin Name</mat-label>
              <input matInput formControlName="adminName" />
              <mat-error *ngIf="form.controls.adminName.hasError('required')">
                Name is required
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Admin Email</mat-label>
              <input matInput type="email" formControlName="adminEmail" />
              <mat-error *ngIf="form.controls.adminEmail.hasError('required')">
                Email is required
              </mat-error>
              <mat-error *ngIf="form.controls.adminEmail.hasError('email')">
                Enter a valid email
              </mat-error>
            </mat-form-field>
          </div>

          <div class="two-column">
            <mat-form-field appearance="outline">
              <mat-label>Password</mat-label>
              <input
                matInput
                [type]="hidePassword ? 'password' : 'text'"
                formControlName="adminPassword"
                autocomplete="new-password"
              />
              <button
                mat-icon-button
                matSuffix
                type="button"
                (click)="hidePassword = !hidePassword"
                [attr.aria-label]="hidePassword ? 'Show password' : 'Hide password'"
              >
                <mat-icon>{{ hidePassword ? 'visibility_off' : 'visibility' }}</mat-icon>
              </button>
              <mat-error *ngIf="form.controls.adminPassword.hasError('required')">
                Password is required
              </mat-error>
              <mat-error *ngIf="form.controls.adminPassword.hasError('minlength')">
                Minimum 8 characters required
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Admin Phone</mat-label>
              <input matInput formControlName="adminPhone" />
            </mat-form-field>
          </div>
        </section>

        <button
          mat-flat-button
          color="primary"
          class="submit-button"
          type="submit"
          [disabled]="loading"
        >
          <mat-progress-spinner
            *ngIf="loading"
            mode="indeterminate"
            diameter="18"
            strokeWidth="3"
          ></mat-progress-spinner>
          <span *ngIf="!loading">Create Workspace</span>
        </button>
      </form>
    </mat-card-content>

    <mat-card-actions>
      <a routerLink="/auth/login">Already have an account? Sign in</a>
    </mat-card-actions>
  </mat-card>
</div>

